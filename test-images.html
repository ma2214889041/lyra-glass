<!DOCTYPE html>
<html>
<head>
    <title>å›¾ç‰‡åŠ è½½æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #000; 
            color: #fff;
        }
        .test-item { 
            margin: 20px 0; 
            padding: 15px; 
            background: #1a1a1a; 
            border-radius: 8px;
        }
        img { 
            max-width: 300px; 
            border: 2px solid #333; 
            border-radius: 4px;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .info { color: #60a5fa; }
    </style>
</head>
<body>
    <h1>ğŸ” å›¾ç‰‡åŠ è½½è¯Šæ–­</h1>
    
    <div class="test-item">
        <h3>æµ‹è¯• 1: ç›´æ¥åŠ è½½ R2 å›¾ç‰‡</h3>
        <p class="info">URL: https://pub-3b82dd9729d24fa2a1dfacf4d4c2ab3a.r2.dev/generated/1/7fab0d56-8eca-4bc2-b3c3-3ef5a71ef177.png</p>
        <img 
            id="r2-image" 
            src="https://pub-3b82dd9729d24fa2a1dfacf4d4c2ab3a.r2.dev/generated/1/7fab0d56-8eca-4bc2-b3c3-3ef5a71ef177.png"
            onload="document.getElementById('r2-status').innerHTML = 'âœ… åŠ è½½æˆåŠŸï¼'; document.getElementById('r2-status').className = 'success';"
            onerror="document.getElementById('r2-status').innerHTML = 'âŒ åŠ è½½å¤±è´¥ï¼æ£€æŸ¥ CORS æˆ– URL'; document.getElementById('r2-status').className = 'error';"
        />
        <p id="r2-status" class="info">â³ åŠ è½½ä¸­...</p>
    </div>

    <div class="test-item">
        <h3>æµ‹è¯• 2: API è¯·æ±‚</h3>
        <button onclick="testAPI()" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
            æµ‹è¯• /api/user/history
        </button>
        <pre id="api-result" style="background: #0a0a0a; padding: 10px; border-radius: 4px; margin-top: 10px; overflow-x: auto;"></pre>
    </div>

    <script>
        async function testAPI() {
            const result = document.getElementById('api-result');
            result.textContent = 'â³ è¯·æ±‚ä¸­...';
            
            try {
                // ä» localStorage è·å– token
                const token = localStorage.getItem('token');
                
                if (!token) {
                    result.textContent = 'âŒ æœªæ‰¾åˆ° tokenï¼Œè¯·å…ˆç™»å½•ï¼';
                    result.style.color = '#f87171';
                    return;
                }

                const response = await fetch('http://localhost:3001/api/user/history', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                result.textContent = JSON.stringify(data, null, 2);
                result.style.color = response.ok ? '#4ade80' : '#f87171';
                
                if (data.success && data.images && data.images.length > 0) {
                    result.textContent += '\n\nâœ… æ‰¾åˆ° ' + data.images.length + ' å¼ å›¾ç‰‡ï¼';
                } else {
                    result.textContent += '\n\nâš ï¸ æ²¡æœ‰å›¾ç‰‡æ•°æ®';
                }
            } catch (error) {
                result.textContent = 'âŒ è¯·æ±‚å¤±è´¥: ' + error.message;
                result.style.color = '#f87171';
            }
        }
    </script>
</body>
</html>
